<%- include('partials/header'); -%>

<div class="container container-small">

    <% if (errors.length) { %>
    <div class="notification error">
        <% errors.forEach(function(error) { %>
            <li><strong>Erreur : </strong><%= error %></li>
        <% }) %>
    </div>
    <% } %>

    <% if (messages.length) { %>
    <div class="notification">
        <%- messages %>
    </div>
    <% } %>

    <div class="panel margin-top-m">
        <h3>Cr√©er ma fiche Github</h3>

        <p>
            Bienvenue dans la communaut√© üëã !<br>
            Cr√©er ta fiche Github est la premi√®re √©tape pour avoir acc√®s aux diff√©rents outils de la communaut√©.
        </p>

        <div class="beta-banner"></div>

        <form action="/onboarding" method="POST" onsubmit="event.submitter && (event.submitter.disabled = true);">
            <h4>Tes infos persos</h4>

            <div class="form__group">
                <p>
                    Tes informations personnelles seront affich√©s sur la page <a href="https://beta.gouv.fr/communaute/" target="_blank">Communaut√©</a> du site BetaGouv, ainsi que dans la fiche de ta startup.
                </p>
                <label for="firstName">
                    <strong>Pr√©nom (obligatoire)</strong>
                </label>
                <input name="firstName" value="<%= formData.firstName %>" required>
                <label for="lastName">
                    <strong>Nom de famille (obligatoire)</strong>
                </label>
                <input name="lastName" value="<%= formData.lastName %>" required>
            </div>

            <div class="form__group">
                <label for="description">
                    <span>Courte bio</span><br />
                    Raconte-nous qui tu es dans une phrase percutante !
                    <textarea rows="2" name="description"><%= formData.description %></textarea>
                </label>
            </div>

            <div class="form__group">
                <label for="website">
                    <span>Site personnel</span><br />
                    Commen√ßant avec <em>http://</em> ou <em>https://</em>
                </label>
                <input name="website" pattern="^(http|https)://$" value="<%= formData.website %>" title="Doit commencer par http:// ou https://">
            </div>

            <div class="form__group">
                <label for="github">
                    <span>Utilisateur Github</span><br />
                    Si tu as un compte, tu peux √™tre ajout√© √† l'organisation Github BetaGouv.
                </label>
                <input name="github" pattern="^(?!http://|https://).+" value="<%= formData.github %>" title="Pas d'url, juste ton nom d'utilisateur Github">
            </div>


            <h4>Ta mission</h4>
            <div class="form__group">
                <label for="role">
                    <strong>R√¥le chez BetaGouv (obligatoire)</strong><br />
                    D√©veloppeuse, Intrapreneur, Charg√©e de d√©ploiement, Coach, UX Designer...
                </label>
                <input name="role" value="<%= formData.role %>" required>
            </div>

            <div class="form__group">
                <label for="start">
                    <strong>D√©but de la mission (obligatoire)</strong><br />
                    Au format JJ/MM/YYYY
                </label>
                <input type="date" name="start" pattern="^\d{4}-\d{2}-\d{2}$" min="<%= userConfig.minStartDate %>" value="<%= formData.start %>" title="En format YYYY-MM-DD, par exemple : 2020-01-31" required>
            </div>

            <div class="form__group">
                <label for="end">
                    <strong>Fin de la mission (obligatoire)</strong><br />
                    Au format JJ/MM/YYYY
                </label>
                <input type="date" name="end" pattern="^\d{4}-\d{2}-\d{2}$" value="<%= formData.end %>" title="En format YYYY-MM-DD, par exemple : 2020-01-31" required>
            </div>

            <div class="form__group">
                <label for="status">
                    <strong>Statut (obligatoire)</strong><br />
                </label>
                <% userConfig.statusOptions.forEach(function(status) { %>
                    <input type="radio" name="status" value="<%= status.value %>" <%= (status.value === formData.status) ? 'checked' : '' %> required><%= status.label %><br>
                <% }) %>
            </div>

            <div class="form__group">
                <label for="referentList">
                    R√©f√©rent<br />
                    Renseigne le nom d‚Äôune personne de la communaut√© avec qui tu es en contact.
                </label>
                <% if(useSelectList) { %>
                    <select name="referent" id="username_select">
                    <% users.forEach(function(user) { %>
                        <option value="<%= user.id %>"> <%= user.fullname %> </option>
                    <% }) %>
                    </select>
                <% } else { %> 
                    <input name="referentList" list="user_names" id="referentList">
                    <datalist id="user_names">
                    <% users.forEach(function(user) { %>
                        <option data-value="<%= user.id %>" value="<%= user.fullname %>">
                    <% }) %>
                    </datalist>
                    <input type="hidden" name="referent" id="referentInput_hidden">
                <% } %> 
            </div>

            <% if(!useSelectList) { %>
            <script>
            document.getElementById('referentList').addEventListener('input', (e) => {
                const input = e.target
                const hiddenInput = document.getElementById('referentInput_hidden')
                const options = document.querySelectorAll('#user_names option')

                for (let i = 0; i < options.length ; i++) {
                    const option = options[i]
                    if (option.value === input.value.trim() && option.hasAttribute('data-value')) {
                        hiddenInput.value = option.getAttribute('data-value')
                    }
                }
            })
            </script>
            <% } %>

            <div class="form__group">
                <label for="startup">
                    <span>Startup d'√âtat</span><br />
                    Laisser vide si elle n'appara√Æt pas. Tu pourras modifier ton profil plus tard.
                </label>
                <select name="startup">
                    <option value=""></option>
                    <% startups.forEach(function(startup) { %>
                        <option value="<%= startup.id %>" <%= (startup.id === formData.startup) ? 'selected' : '' %>><%= startup.attributes.name %></option>
                    <% }) %>
                </select>
            </div>

            <div class="form__group">
                <label for="employer">
                    <span>Employeur</span><br />
                    L'entit√© avec laquelle tu as sign√© ton contrat (DINUM, Octo...)
                </label>
                <input name="employer" value="<%= formData.employer %>">
            </div>

            <div class="form__group">
                <label for="badge">
                    <span>Badge</span><br />
                    Si tu souhaites acc√©der aux bureaux, il te faudra un badge. Il te faudra aussi en faire la demande s√©par√©ment.
                    En cochant cette case, nous saurons que tu en fais la demande et le badge sera renouvell√© automatiquement.
                </label>
                <select name="badge">
                    <option value=""></option>
                    <% userConfig.badgeOptions.forEach(function(badge) { %>
                        <option value="<%= badge.value %>" <%= (badge.value === formData.badge) ? 'selected' : '' %>><%= badge.label %></option>
                    <% }) %>
                </select>
            </div>

            <h4>Moyen de contact</h4>
            <label for="email">
                <strong>Email pro/perso (obligatoire)</strong><br />
                Ton email nous servira pour t'envoyer les informations relatives √† ton compte
            </label>
            <input name="email" value="<%= formData.email %>" required>

            <button class="button" type="submit">Soumettre ma demande</button>
        </form>
    </div>
</div>
