<%- include('partials/nav-header'); -%>

<link rel="stylesheet" media="screen,print" href='/static/collapse/collapse.css'>
<script src="/static/collapse/collapse.js"></script>
<link rel="stylesheet" href="//code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
<link rel="stylesheet" href="/resources/demos/style.css">
<script src="https://code.jquery.com/jquery-3.6.0.js"></script>
<script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
<script>
    $( function() {
      $( document ).tooltip();
    } );
    </script>
<div class="module">
    <div>
        <small>
            <a href="/account">Mon compte</a>
        </small>
    </div>
    <div class="margin-top-m"></div>
    <% if (hasActiveResponder) { %>
        <div class="notification warning">
            <strong>R√©ponse automatique activ√©e.</strong>
            <a href="/account#responder">D√©sactiver maintenant</a>
            <a href="/account#responder">Configurer la r√©ponse</a>
        </div>
    <% } %>
    <div class="row">
        <div class="panel panel-partial-width">
            <div>
                <h3>
                    Mon compte beta.gouv
                </h3>
                <div>
                    <% if (userInfos) { %>
                        <p><span class="font-weight-bold">Nom</span>: <%= userInfos.fullname %></p>
                    <% } %>
                    <p>
                        <span class="font-weight-bold">R√¥le:</span> <%= userInfos.role %>
                    </p>
                    <% if (userInfos.startups) { %>
                      <p>
                          <span class="font-weight-bold">Startups actuelles:</span><br>
                          <% for (var i=0; i < userInfos.startups.length; i++) { %>
                          - <%= userInfos.startups[i] %><br>
                          <% } %>
                      </p>
                    <% } %>
                    <p>
                    <!-- <span class="font-weight-bold">startup(s) pr√©c√©dente(s):</span> <%= userInfos.previously %><br><br> -->
                    </p>
                    <% if (userInfos.end) { %>
                        <p>
                            <span class="font-weight-bold">Fin de mission :</span>
                            <!-- du <%= new Date(userInfos.start).toLocaleDateString('fr-FR') %> -->
                            <% if (userInfos.end) { %><%= new Date(userInfos.end).toLocaleDateString('fr-FR') %><% } %>
                        </p>    
                    <% } %>
                    <% if (userInfos.employer) { %>
                        <p>
                            <strong>Employeur : </strong><%= userInfos.employer.replace('admin/', '') %>
                        </p>
                    <% } %>
                    <% if (userInfos.github) { %>
                        <p>
                            <strong>Compte Github :</strong>
                            <% if (userInfos.github) { %>
                                <a href="https://github.com/<%= userInfos.github %>"><%= userInfos.github %></a>
                            <% } else { %>
                                Non renseign√©
                            <% } %>
                        </p>
                    <% } %>
                    <br>
                    <center>
                    <small>Une de ces informations n'est plus juste ?</small><br>
                    <% if (updatePullRequest) { %>
                        <br>
                        <div class="notification">
                            ‚ö†Ô∏è Une pull request existe d√©j√† sur ta fiche membre. Toi ou un membre de ton √©quipe doit la merger pour que les changements soit pris en compte
                            <a href="<%= updatePullRequest.url %>" target="_blank"><%= updatePullRequest.url %></a>
                            <br>(la prise en compte peut prendre 10 minutes.)
                        </div>
                    <% } %>
                    <a class="button" href="/account/base-info">‚úèÔ∏è Mettre √† jour mes infos</a></center>

                    <!-- <div class="collapse">
                        <h6 class="margin-10-0 collapse-header">
                            <button aria-expanded="false" id="update-end-date">
                                Mettre √† jour ma date de fin
                                <div class="icon fa fa-chevron-down"></div>
                            </button>
                        </h6>
                        <div hidden class="collapse-content">
                            <section id="update-end-date-form" class="panel">
                                <div class="notification">
                                    Pour que ton changement de date soit pris en compte,
                                    demande √† un membre de ton √©quipe de
                                    "merger" le changement sur <a href="https://github.com/betagouv/beta.gouv.fr/pulls" target="_blank">github</a>.
                                </div>
                                <form action="/users/<%= userInfos.id %>/end-date" method="POST">
                                    <input type="hidden" name="_method" value="PUT">
                                    <input type="hidden" name="start" value="<%= userInfos.start %>">
                                    <input type="hidden" name="end" value="<%= userInfos.end %>">
                                    <p>
                                        <strong>Date de fin actuelle :</strong>
                                        <% if (userInfos.end) { %>
                                            <%= new Date(userInfos.end).toLocaleDateString('fr-FR') %>
                                        <% } else { %>
                                            Non renseign√©e
                                        <% } %>
                                    </p>
                                    <div class="form__group">
                                        <label for="end">
                                            <strong>Nouvelle date de fin</strong>
                                        </label>
                                        <input type="date" name="newEnd" pattern="^\d{4}-\d{2}-\d{2}$" value="<%= formData.newEnd %>" title="En format YYYY-MM-DD, par exemple : 2020-01-31" required>
                                    </div>
                                    <div class="form__group button__group">
                                        <button class="button" type="submit">Valider</button>
                                        <button id="update-end-date-form-cancel-button" class="button secondary">Annuler</button>
                                    </div>
                                </form>
                            </section>
                            <hr />
                        </div>
                    </div>
                    <div class="collapse">
                        <h6 class="margin-10-0 collapse-header">
                            <button aria-expanded="false" id="webmail">
                                Mettre √† jour ma fiche
                                <div class="icon fa fa-chevron-down"></div>
                            </button>
                        </h6>
                        <div hidden class="collapse-content">
                            <a class="button no-margin" href="https://github.com/betagouv/beta.gouv.fr/edit/master/content/_authors/<%= userInfos.id %>.md" target="_blank">Modifier sur Github</a> 
                            <hr />
                        </div>
                    </div> -->
                </div>
            </div>
        </div>
        <div class="panel margin-top-0 panel-partial-width">
            <h6>Observatoire de la Communaut√© (<a href="https://metabase.incubateur.net/public/dashboard/554ff353-6104-4c25-a261-d8bdc40f75d5" target="_blank">consulter l'observatoire</a>)</h6>
                <br>
                <p>
                    <span class="font-weight-bold">Lieu de travail principal : </span> <%= workplace || 'Non renseign√©' %>
                </p>
                <p>
                    <span class="font-weight-bold">Genre : </span> <span class="hide-info-detail"><span><%= gender || 'Non renseign√©' %></span></span>
                </p>
                <p>
                    <span class="font-weight-bold">TJM : </span> <span class="hide-info-detail"><span><%= tjm || 'Non renseign√©' %></span></span>
                </p>
                <p>
                    <span class="font-weight-bold">Statut Legal : </span><nobr><%= legal_status || 'Non renseign√©' %></nobr>
                </p>
                <p>
                    <span class="font-weight-bold">Nombre de jours par semaine : </span> <%= average_nb_of_days || 'Non renseign√©' %>
                </p>
                <center>
                    <small>Une de ces informations n'est plus juste ?</small>
                    <br>
                    <a class="button" href="/account/info">Mettre √† jour</a>
                </center>
                <br/>
                <br/>
        </div>
    </div>
    <div class="row">
        <div class="panel panel-full-width">
            <div className="beta-banner"></div>
            <h3>Mon aventures beta.gouv.fr</h3>
            L'√©cosyst√®me betagouv peut √™tre un peu complexe, afin d'y √™tre le mieux int√©gr√© possible, nous t'invitons √† r√©aliser quelques un des achievements ci-dessus. 
            Biens√ªr rien n'est obligatoire :) Les badges te servent uniquement a titre personnel pour avoir une vision r√©sum√© des diff√©rentes choses que tu peux faire.
            <h6>
                Mes badges 
            </h6>
            <div class="account-split-panel" style="justify-content: start;">
                <div style="width: 100px; height: 100px; padding: 10px;">
                    <img style="width: 100%" title="Tu as rejoins beta.gouv.fr ! Bienvenue ! " src="/static/images/logo-betagouv.jpg" />
                </div>
                <div style="width: 100px; height: 100px; padding: 10px; opacity: 0.2;">
                    <img style="width: 100%" title="Tu n'as pas encore rejoins mattermost. Un compte t'as normalement √©t√© cr√©√© tu peux le rejoindre en reinitialisant le mot de passe." src="/static/images/mattermost.png" />
                </div>
                <div>
                    <img
                    id="badge-video"
                    style="width: 100px; height: 100px; opacity: 0.2;"
                    title="Tu n'as pas encore visionn√© les videos de pr√©sentations de beta.gouv ? Elles sont au nombre de trois, et te permettrons de mieux appr√©hender les valeurs et la mani√®re de travailler √† beta. Si tu les a visionn√© tu peux cocher la case en dessous." src="/static/images/artica.png" />
                </div>
                <div>
                    <img 
                    id="badge-onboarding"
                    style="width: 100px; height: 100px; opacity: 0.2;" title="Tu n'as pas encore suivi la session d'embarquement ? Tu peux retrouver les diff√©rentes sessions sur le canal mattermost. Si tu en as d√©j√† suivi une n'h√©site pas √† l'actualiser en dessous pour √©viter de recevoir les nouvelles sessions par email."
                    src="/static/images/mars-2020-contributor-default.png" />
                </div>
                <div>
                    <img
                    id="badge-doc"
                    src="/static/images/public-sponsor-default.png"
                    style="width: 100px; height: 100px; opacity: 0.2;"
                    title="Tu n'as pas encore contribu√© √† la doc ?
                    La doc beta.gouv.fr est une partie important de l'√©cosyst√®me beta.gouv, chacun est libre d'y contribuer, voici le lien pour y acc√©der √† l'admin ainsi que la doc pour expliquer comment faire des changements."/>
                </div>
                <div>
                    <img
                        id="badge-formation"
                        src="/static/images/pull-shark-gold.png"
                        style="width: 100px; height: 100px; opacity: 0.2;"
                    title="Tu n'as pas encore participer √† une formation ? Nous t'invitons √† suivre une des formations proposer par beta.gouiv tout le monde √† le droit d'y participer et de prendre sur le temps factur√© √† la SE (dans le respect des 10% a accord√© en transverse) pour le faire"/>
                </div>
                <div>
                    <img
                        id="badge-transverse"
                        src="/static/images/starstruck-default.png" style="width: 100px; height: 100px; opacity: 0.2;" title="Tu n'as pas encore participer √† une mission transverse ? Tu as le droit de consacr√© 10% du temps factur√© √† ta startup √† r√©aliser une action transverse, soit en proposant quelque chose de ta propre initiative, soit en participant aux taskforce existente, l'equipe Communaut√© Exp√©rience vous propose sur le channel ~general et sur ~incubateur-communauteXP de participer a des missions. Si tu as d√©j√† fait une mission transverse tu peux cocher a case correspondante en dessous." />
                </div>
                <div>
                    <img
                        id="badge-parrainage"
                        style="width: 100px; height: 100px; opacity: 0.2;"
                        title="Tu n'as encore marrain√© personne ? Au del√† d'un temps de 6 mois au sein de beta.gouv tu peux parrain√© quelqu'un, voici en quoi consiste le marrainage. Tu peux t'inscrire en tant que parrain sur le formulaire suivant. Si tu as d√©j√† fait un marrainage tu peux cocher la case en dessous." src="/static/images/pair.png" />
                </div>
                <div>
                    <img
                        id="badge-forum"
                        style="width: 100px; height: 100px; opacity: 0.2;"
                        title="Tu n'as pas encore assist√© a un forum ouvert ? Le forum ouvert est un √©v√©nement beta qui a lieu tous les mois. Tu as le droit d'y participer sur le temps que tu factures a ta SE. Il y a des ateliers mais aussi des espaces pour travailler. Tu peux donc participer a un atelier et travailler le reste du temps. L'id√©e a d'avoir un moment d'√©change en pr√©sentiel. Le forum ouvert se fini souvent par un ap√©ro. Si tu as d√©j√† participer a un forum ouvert, tu peux le mentionner en dessous." src="/static/images/brain.png" />
                </div>
                <!-- <div>
                    <img style="width: 100px; height: 100px; opacity: 0.2;" title="j'ai rejoins mattermost" src="/static/images/artica.png" />
                </div>
                <div>
                    <img style="width: 100px; height: 100px; opacity: 0.2;" title="j'ai rejoins mattermost" src="/static/images/brain.png" />
                </div> -->
            </div>
            <h6>
                Les etapes du parcours
            </h6>
            <p><input type="checkbox" id="onboarding" /> As-tu particip√© √† une session d'embarquement ?</p>
            <p><input type="checkbox" id="video"/> As-tu visionn√© les vid√©os de pr√©sentation de beta.gouv ?</p>
            <p><input type="checkbox" id="formation"/> As-tu particip√© √† une autre formation ?</p>
            <p><input type="checkbox" id="forum"/> As-tu particip√© √† un des forums ouverts ?</p>
            <p><input type="checkbox" id="transverse"/> As-tu particip√© √† une missions transverse ?</p>
            <p><input type="checkbox" id="doc"/> As-tu contribu√© √† la doc ?</p>
            <p><input type="checkbox" id="parrainage"/> As-tu parrain√©/marrain√© quelqu'un ?</p>

        </div>
    </div>
    <div class="row">
        <div class="panel panel-full-width">
            <div className="beta-banner"></div>
            <h3>Mes formations</h3>
            <h4>Mes formations √† venir :</h4>  
            <ul>
                <li>Sensibilisation accessibilit√© et RGAA</li>
                <li>Atelier accessibilit√© : 10 choses √† v√©rifier pour un site plus accessible</li>
            </ul>
            <h4>Mes formations pass√©es :</h4>  
            <div>
                <h6>Design/Produit</h6>   
                <ul>
                    <li>Sensibilisation accessibilit√© et RGAA</li>
                    <li>Atelier accessibilit√© : 10 choses √† v√©rifier pour un site plus accessible</li>
                    <li>Initiation aux outils no-code</li>
                    <li>No-code : Glide + Bubble + Adalo</li>
                    <li>Comprendre l‚Äôutilisateur, psychologie cognitive et ergonomie - Formation UX S1E1</li>
                </ul>
            </div>
            <div>
                <h6>Divers</h6>
                <ul>
                    <li>NUMA#1 : Ex√©cution : Gagner une demie journ√©e par semaine</li>
                    <li>NUMA #2 : Conversations difficiles, √™tre √† l'aise avec le feedback</li>
                    <li>Automatisez vos t√¢ches avec Zapier</li>
                    <li>NUMA#3 : La m√©thode OKRs</li>
                    <li>Formation NUMA #4 : Coaching</li>
                </ul>
            </div>
            <div>
                <h6>Marketing/Communication</h6>
                <ul>
                    <li>Design inclusif</li>
                    <li>Formation NUMA #8 : Influence </li>
                    <li>Utiliser une m√©thode qui d√©chire pour faire semblant √™tre la reine du growth hacking</li>
                    <li>Formation NUMA - Conversations difficiles</li>
                    <li>Avoir un profil Linkedin au top</li>
                </ul>
            </div>
            <div>
                <h6>Tech</h6>
                <ul>
                    <li>üßë‚ÄçüíªFormation Dev pour les non-Devs üë©‚Äçüíª</li>
                    <li>Formation Git et GitHub</li>
                </ul>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="panel panel-full-width">
            <h3>
                Mon email
            </h3>
            <% if (emailInfos) { %>
                <p> <span class="font-weight-bold">Email principal : </span><span class="font-weight-bold text-color-blue"><%= emailInfos.email %>
                <% if (emailInfos.isPro) { %> 
                    (offre OVH Pro)
                <% } %>
                <% if (emailInfos.isExchange) { %>
                    (offre OVH Exchange)
                <% } %>
                </p>
            <% } %>
            <% if (!emailInfos && primaryEmail && !primaryEmail.includes(domain)) { %>
            <p> <span class="font-weight-bold">Email principal : </span><span class="font-weight-bold text-color-blue"><%= primaryEmail %>
            <% } %>
            <p>
                <span class="font-weight-bold">Email secondaire : </span> <%= secondaryEmail || 'Non renseign√©' %>
            </p>
            <% if (isAdmin) { %>
                <% if (availableEmailPros.length && emailInfos && !emailInfos.isPro && !emailInfos.isExchange) { %>
                    <p>Il y a <%= availableEmailPros.length %> compte disponibles.</p>
                    <p>Passer ce compte en pro : </p>
                    <form class="no-margin" action="/users/<%= userInfos.id %>/email-upgrade" method="POST" onsubmit="event.submitter && (event.submitter.disabled = true);">
                        <label>
                            <span class="text-color-almost-black">Un mot de passe pour ton compte</span><br />
                        </label>
                        <input name="password" type="password" required min="8">
                        <button class="button no-margin" type="submit">Upgrader en compte pro</button>
                    </form>
                    <br>
                    <br>
                <% } %>
            <% } %>
            <% if (canCreateEmail) { %>
                <p>Tu peux cr√©er ton compte email @beta.gouv.fr.</p>
                <% if (hasPublicServiceEmail) { %>
                    Attention tu as une adresse de service public en adresse primaire. Si tu cr√©√©s une adresse @beta.gouv.fr, elle deviendra ton adresse primaire :
                    celle √† utiliser pour mattermost, et d'autres outils.
                <% } %>
                <form class="no-margin" action="/users/<%= userInfos.id %>/email" method="POST" onsubmit="event.submitter && (event.submitter.disabled = true);">
                    <div class="form__group  margin-10-0">
                        <label>
                            <span class="text-color-almost-black">Email personnel ou professionnel</span><br />
                            Les informations de connexion seront envoy√©es √† cet email
                        </label>
                        <input value="<%= secondaryEmail %>" name="to_email" type="email" required>
                    </div>
                    <button class="button no-margin" type="submit">Cr√©er un compte</button>
                </form>
                <br>
                <br>
            <% }%>
            <div class="collapse">
                <h6 class="margin-10-0 collapse-header">
                    <button aria-expanded="false" id="configure-email">
                        Configurer mon client mail
                        <div class="icon fa fa-chevron-down"></div>
                    </button>
                </h6>
                <div hidden class="collapse-content">
                    <p>Configure ton client mail pr√©f√©r√© (Mail, Thunderbird, Mailspring, Microsoft Courier, Gmail, etc) pour recevoir et envoyer des emails :</p>

                    <a href="https://doc.incubateur.net/communaute/travailler-a-beta-gouv/jutilise-les-outils-de-la-communaute/emails#envoyer-et-recevoir-des-mails-beta.gouv.fr" target="_blank" class="button no-margin">Documentation de configuration du webmail</a>
                    <hr />
                </div>
            </div>
            <div class="collapse" id="responder">
                <h6 class="margin-10-0 collapse-header">
                    <button aria-expanded="false" id="automatic-response">
                        Configurer une r√©ponse automatique
                        <div class="icon fa fa-chevron-down"></div>
                    </button>
                </h6>
                <div hidden class="collapse-content">
                    <p>
                        Informez vos correspondants de votre absence. Cette r√©ponse automatique sera envoy√©e √† tous les messages que vous recevez. (la mise en place effective de la r√©ponse automatique peut prendre quelques minutes)
                    </p>
                    <form class="no-margin"
                        onsubmit="const proceed = event.submitter.id === 'delete-button' ? confirm('Es-tu s√ªr de vouloir supprimer ton compte email et ses redirections ?') : true; event.submitter && (event.submitter.disabled = proceed); return proceed;"
                        action="/account/set_email_responder" method="POST" >
                    <% if (hasResponder) { %>
                        <input type="hidden" name="method" value="update">
                    <% } %>       
                            <div class="form__group">
                                <label for="start">
                                    <strong>Message d'absence</strong><br />
                                </label>
                                <textarea placeholder="Je ne serai pas en mesure de vous r√©pondre du XX/XX au XX/XX. En cas d'urgence, n'h√©sitez pas √† contacter ..." id="emailResponder" name="content" value="<%= responderFormData.content %>"><%= responderFormData.content %></textarea>
                            </div>
                            <div class="form__group">
                                <label for="start">
                                    <strong>D√©but</strong><br />
                                    <i>Au format JJ/MM/YYYY</i>
                                </label>
                                <input type="date" name="from" pattern="^\d{4}-\d{2}-\d{2}$" value="<%= responderFormData.from %>" title="En format YYYY-MM-DD, par exemple : 2020-01-31" required>
                            </div>
                
                            <div class="form__group">
                                <label for="end">
                                    <strong>Fin</strong><br />
                                    <i>Au format JJ/MM/YYYY</i>
                                </label>
                                <input type="date" name="to" pattern="^\d{4}-\d{2}-\d{2}$" value="<%= responderFormData.to %>" title="En format YYYY-MM-DD, par exemple : 2020-01-31" required>
                            </div>
                    <% if (!hasResponder) { %>
                            <button class="button margin-10-0" type="submit">Sauvegarder</button>
                        </form>
                    <% } else { %>
                            <div class="row">
                                <button class="button margin-10-0" type="submit">Changer</button>
                                <% if (hasResponder) { %>
                                        <button
                                            id='delete-button'
                                            class="button margin-10-0 button-underline" formaction="/account/delete_email_responder" type="submit">Supprimer</button>
                                <% } %> 
                            </div>
                        </form>
                    <% } %> 
                    <hr />
                </div>
            </div>
            <div class="collapse">
                <h6 class="margin-10-0 collapse-header">
                    <button aria-expanded="false" id="password">
                        Changer mon mot de passe
                        <div class="icon fa fa-chevron-down"></div>
                    </button>
                </h6>
                <div hidden class="collapse-content">
                    <% if (canChangePassword) { %>
                        <p>
                            Nouveau mot de passe du compte email :<br />
                            Le mot de passe doit comporter entre 9 et 30 caract√®res, pas d'accents, et pas
                            d'espace au d√©but ou √† la fin.
                        </p>

                        <form class="no-margin" action="/users/<%= userInfos.id %>/password" method="POST" onsubmit="event.submitter && (event.submitter.disabled = true);">
                            <input name="new_password" type="password" minlength="9" required>
                            <button class="button margin-10-0" type="submit">Changer</button>
                        </form>
                    <% } else if (emailSuspended) { %>
                        <p>Il faut mettre √† jour votre date de fin de mission et merger la pull request avant de pouvoir changer votre mot de passe</p>
                    <% } else { %>
                        <p>Sans compte email, vous n'avez pas la possibilit√© de changer de mot de passe.</p>
                    <% } %>
                    <hr />
                </div>
            </div>

            <div class="collapse">
                <h6 class="margin-10-0 collapse-header">
                    <button aria-expanded="false" id="webmail">
                        Acc√©der au webmail
                        <div class="icon fa fa-chevron-down"></div>
                    </button>
                </h6>
                <div hidden class="collapse-content">
                    <p>
                        Tu peux consulter tes mails directement sur l'interface d'OVH. Elle n'est pas tr√®s
                        confortable mais √ßa peut √™tre une bonne solution pour d√©panner, ou quand tu n'a pas
                        acc√®s √† ton client web habituel.
                    </p>
                    <a href="https://mail.ovh.net/roundcube/?_user=<%= userInfos.id %>@<%= domain %>" target="_blank" class="button no-margin">Webmail</a>
                    <hr />
                </div>
            </div>

            <div class="collapse">
                <h6 class="margin-10-0 collapse-header">
                    <button aria-expanded="false" id="redirect-email">
                        Rediriger vers une autre adresse mail
                        <div class="icon fa fa-chevron-down"></div>
                    </button>
                </h6>
                <div hidden class="collapse-content">
                    <p>üö® Il n'est pas recommand√© d'utiliser les redirections : <b>certains de tes messages seront perdus</b>. Mais une redirection peut √™tre utile en compl√©ment d'une r√©cup√©ration <i>POP</i> ou d'une application type Frontapp.</p>
                    <% redirections.forEach(function(redirection) { %>
                        <div class="redirection-item">
                            <%= redirection.to %>
                            <% if (canCreateRedirection) { %>
                                <form class="redirection-form" action="/users/<%= userInfos.id %>/redirections/<%= redirection.to %>/delete" method="POST" onsubmit="event.submitter && (event.submitter.disabled = true);">
                                <button class="redirection-remove button-outline small warning" type="submit">Supprimer</button>
                                </form>
                            <% } %>
                        </div>
                    <% }) %>
                    <% if (canCreateRedirection) { %>
                        <form class="no-margin" action="/users/<%= userInfos.id %>/redirections" method="POST" onsubmit="event.submitter && (event.submitter.disabled = true);">
                            <div class="form__group">
                                <label for="to_email">Rediriger mes mails <%= domain %> vers :</label>
                                <input name="to_email" type="email" required>
                            </div>
                            <div class="input__group margin-10-0">
                            <input type="checkbox" name="keep_copy" value="true">
                            <label>Garder une copie des emails si un compte existe</label>
                            </div>
                            <button class="button no-margin" type="submit">Ajouter la redirection</button>
                        </form>
                    <% } else { %>
                        <% if (isExpired) { %>
                        <div class="notification error">
                            Le compte <%= userInfos.id %> est expir√©.
                        </div>
                        <% } else { %>
                        <div class="notification warning">
                            Seul <%= userInfos.id %> peut cr√©er ou modifier les redirections.
                        </div>
                        <% } %>
                    <% } %>
                    <hr />
                </div>
            </div>
            <div class="collapse">
                <h6 class="margin-10-0 collapse-header">
                    <button aria-expanded="false" id="change-primary-email">
                        Configurer mon email principal
                        <div class="icon fa fa-chevron-down"></div>
                    </button>
                </h6>
                <div hidden class="collapse-content">
                    <p>
                        L'email principal est utilis√© pour toutes les communications en rapport avec Betagouv.
                        Ce doit √™tre un email d'agent public. Il s'agit par d√©faut de <%= userInfos.id %>@beta.gouv.fr.
                        <br>
                        <br>
                        En cas d'utilisation d'une adresse autre, l'email <%= userInfos.id %>@beta.gouv.fr sera supprim√©.
                    </p>
                    <% if (canChangeEmails) { %>
                    <form class="no-margin" action="/users/<%= userInfos.id %>/primary_email" method="POST" onsubmit="event.submitter && (event.submitter.disabled = true);">
                        <input id="primaryEmail" name="primaryEmail" value="<%= primaryEmail %>" type="email">
                        <button class="button margin-10-0" type="submit">Sauvegarder l'email principal</button>
                    </form>
                    <% } %>
                    <hr />
                </div> 
            </div>
            <div class="collapse">
                <h6 class="margin-10-0 collapse-header">
                    <button aria-expanded="false" id="change-secondary-email">
                        Configurer mon email secondaire
                        <div class="icon fa fa-chevron-down"></div>
                    </button>
                </h6>
                <div hidden class="collapse-content">
                    <p>
                        L'email secondaire est utile pour r√©cup√©rer son mot de passe ou garder contact apr√®s ton d√©part.
                    </p>
                    <% if (canChangeEmails) { %>
                    <form class="no-margin" action="/users/<%= userInfos.id %>/secondary_email" method="POST" onsubmit="event.submitter && (event.submitter.disabled = true);">
                        <input id="secondaryEmail" name="secondaryEmail" value="<%= secondaryEmail %>" type="email">
                        <button class="button margin-10-0" type="submit">Sauvegarder l'email secondaire</button>
                    </form>
                    <% } %>
                    <hr />
                </div> 
            </div>
            <div class="collapse">
                <h6 class="margin-10-0 collapse-header">
                    <button aria-expanded="false" id="change-communication-email">
                        Quel email utiliser pour les communications @beta.gouv.fr ?
                        <div class="icon fa fa-chevron-down"></div>
                    </button>
                </h6>
                <div hidden class="collapse-content">
                    <% if (!!primaryEmail && !secondaryEmail) { %>
                        Tu n'as qu'une seule adresse <%= primaryEmail %>. Ajoute une adresse secondaire pour choisir sur quelles adresses tu souhaites recevoir les communications
                    <% } %>
                    <% if (!!primaryEmail && !!secondaryEmail) { %>
                    <form class="no-margin" action="/account/update_communication_email" method="POST" onsubmit="event.submitter && (event.submitter.disabled = true);">
                    <div>
                        <input type="radio"
                            id="primary"
                            name="communication_email"
                            value="primary"
                            <% if (communication_email === 'primary') { %>
                                checked
                            <% } %>    
                            ><%= primaryEmail %>
                      </div>
                      <div>
                        <input
                            type="radio"
                            id="secondary"
                            name="communication_email"
                            value="secondary"
                            <% if (communication_email === 'secondary') { %>
                                checked
                            <% } %>    
                            >
                        <%= secondaryEmail %>
                      </div>
                      <button class="button margin-10-0" type="submit">Sauvegarder</button>
                    </form>
                    <% } %>
                    <hr />
                </div> 
            </div>
        </div>
    </div>
    <div class="row">
        <div class="panel panel-full-width">
            <h3>
                        Besoin d'aide ?
                    </h3>
                    <a href="https://doc.incubateur.net/" target="_blank" class="button no-margin">Voir le <span class="font-weight-bold">guide de la communaut√©</span></a>
                    <h4>
                        Parler avec un humain ?
                    </h4>
                    <p>
                    <% if(marrainageState) { %>
                        <% if (marrainageState.completed) { %>
                            Tu peux peut parler √† ton ou ta marrain¬∑e qui est <strong><%= marrainageState.last_onboarder %></strong>.
                        <% } else { %>
                            Nous avons demand√© √† <strong><%= marrainageState.last_onboarder %></strong> de devenir ton ou ta marrain¬∑e, nous attendons sa r√©ponse.
                        <% } %>
                    <% } %>
                        Son role est de t'accompagner dans tes d√©marches et t'aider
                            √† t'orienter au sein de la communaut√©.
                    </p>
                    <% if(!marrainageState) { %>
                        <!-- <form class="no-margin" action="/marrainage" method="POST" onsubmit="event.submitter && (event.submitter.disabled = true);">
                            <div class="form__group">
                                <input type="hidden" name="newcomerId" value="<%= userInfos.id %>">
                            </div>
                            <button class="button secondary no-margin" type="submit">Chercher un¬∑e marrain¬∑e</button>
                        </form> -->
                    <% } else if(!marrainageState.completed) { %>
                        Essai num√©ro <%= marrainageState.count %>, proc√©dure lanc√© le <%= marrainageState.created_at.toLocaleDateString('fr-FR') %>, derni√®re mise √† jour <%= marrainageState.last_updated.toLocaleDateString('fr-FR') %>.
                        <div class="form__group margin-10-0 display-flex">
                            <% if( Date.now() - marrainageState.last_updated.valueOf() > 24*3600*1000 ) { %>
                                <form class="margin-right-10" action="/marrainage/reload" method="POST" onsubmit="event.submitter && (event.submitter.disabled = true);">
                                    <input type="hidden" name="newcomerId" value="<%= userInfos.id %>">
                                    <button class="button secondary no-margin" type="submit">Relancer</button>
                                </form>
                            <% } %>
                            <form class="margin-right-10" action="/marrainage/cancel" method="POST" onsubmit="event.submitter && (event.submitter.disabled = true);">
                                <input type="hidden" name="newcomerId" value="<%= userInfos.id %>">
                                <button class="button secondary no-margin" type="submit">Annuler</button>
                            </form>
                        </div>
                    <% } %>
        </div>
    </div>
    <% if(emailInfos || (redirections && redirections.length > 0)) { %>
        <div class="panel">
            <h3>‚ùó Cl√¥turer mon compte</h3>
            <p>Si tu as quitt√© la communaut√©, cl√¥ture ton compte, ce qui aura pour effet de :</p>
            <ul>
                <li>
                    Supprimer ton compte email
                </li>
                <li>
                    Supprimer toutes tes redirections
                </li>
                <li>
                    Rediriger d'√©ventuels emails vers depart@beta.gouv.fr, ce qui enverra une r√©ponse automatique √† l'exp√©diteur pour l'informer que le compte n'existe plus.
                </li>
            </ul>
            <form onsubmit="const proceed = confirm('Es-tu s√ªr de vouloir supprimer ton compte email et ses redirections ?'); event.submitter && (event.submitter.disabled = proceed); return proceed;" class="no-margin" action="/users/<%= userInfos.id %>/email/delete" method="POST">
                <div class="form__group">
                    <button class="button margin-right-10" type="submit">Cl√¥turer mon compte</button>
                </div>
            </form>
        </div>
    <% } %>

</div>

<%- include('partials/nav-footer'); -%>


<script>
    const form = document.getElementById("update-end-date-form");
    const formToggle = document.getElementById("update-end-date-form-toggle");
    const formCancelButton = document.getElementById("update-end-date-form-cancel-button");
    formToggle.addEventListener("click", function() {
        form.style.display = (form.style.display === "block") ? "none" : "block";
    }, false);
    formCancelButton.addEventListener("click", function() {
        form.style.display = "none";
    }, false);
</script>
<script>
    $(':checkbox').change(function() {
        console.log('LCS CLICK ON CHECKBOX')
        // use evil jquery for quick testing
        var id = $(this).attr('id')
        var checked = $(this).is(':checked');
        if (checked) {
            console.log('LCS DO', id)
            $(`#badge-${id}`).css({
                opacity: 1
            })
        } else {
            console.log('LCS DOn', id)
            $(`#badge-${id}`).css({
                opacity: 0.2
            })
        }
    // do stuff here. It will fire on any checkbox change

    }); 
</script>
